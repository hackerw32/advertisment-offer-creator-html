<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Professional Brochure Creator</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Roboto:wght@300;400;500;700;900&family=Montserrat:wght@300;400;600;700;800;900&family=Lora:wght@400;700&family=Raleway:wght@300;400;600;700&family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            background: linear-gradient(135deg, #1e3a5f 0%, #2d1b4e 100%);
            color: #fff;
            overflow: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
        }

        /* Left Sidebar - Controls */
        .left-sidebar {
            width: 320px;
            background: #0a1929;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .left-sidebar::-webkit-scrollbar {
            width: 8px;
        }

        .left-sidebar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .left-sidebar::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.5);
            border-radius: 4px;
        }

        .logo-header {
            padding: 20px;
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            text-align: center;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .logo-header h1 {
            font-family: 'Playfair Display', serif;
            font-size: 22px;
            color: #fff;
            margin-bottom: 5px;
            font-weight: 900;
        }

        .logo-header p {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 300;
        }

        .lang-toggle {
            display: flex;
            gap: 8px;
            margin: 15px;
        }

        .lang-btn {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(99, 102, 241, 0.3);
            color: #fff;
            cursor: pointer;
            border-radius: 6px;
            font-size: 13px;
            transition: all 0.3s;
            font-weight: 600;
        }

        .lang-btn.active {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-color: #6366f1;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .control-section {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .section-title {
            font-size: 12px;
            font-weight: 700;
            color: #6366f1;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1.2px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 6px;
            font-weight: 600;
        }

        .form-input,
        .form-select {
            width: 100%;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            border-radius: 6px;
            font-size: 13px;
            font-family: 'Roboto', sans-serif;
            transition: all 0.3s;
        }

        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: #6366f1;
            background: rgba(255, 255, 255, 0.08);
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
            font-family: 'Roboto', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: #fff;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .btn-block {
            width: 100%;
            margin-bottom: 8px;
        }

        .page-count-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .page-count-btn {
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 700;
            transition: all 0.3s;
            text-align: center;
        }

        .page-count-btn:hover {
            border-color: #6366f1;
            transform: scale(1.05);
        }

        .page-count-btn.active {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-color: #6366f1;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }

        .size-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .size-btn {
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .size-btn:hover {
            border-color: #6366f1;
        }

        .size-btn.active {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-color: #6366f1;
        }

        .template-scroll {
            max-height: 300px;
            overflow-y: auto;
        }

        .template-scroll::-webkit-scrollbar {
            width: 6px;
        }

        .template-scroll::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .template-scroll::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.5);
            border-radius: 3px;
        }

        .template-item {
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            cursor: pointer;
            margin-bottom: 8px;
            transition: all 0.3s;
        }

        .template-item:hover {
            border-color: #6366f1;
            transform: translateX(4px);
        }

        .template-item.active {
            background: rgba(99, 102, 241, 0.2);
            border-color: #6366f1;
        }

        .template-item h4 {
            font-size: 13px;
            color: #6366f1;
            margin-bottom: 4px;
        }

        .template-item p {
            font-size: 10px;
            color: rgba(255, 255, 255, 0.6);
        }

        /* Canvas Area */
        .canvas-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #132337;
            overflow: hidden;
        }

        .canvas-header {
            background: #0a1929;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .canvas-header h2 {
            font-size: 16px;
            color: #6366f1;
            font-weight: 700;
        }

        .canvas-actions {
            display: flex;
            gap: 10px;
        }

        .pages-nav {
            background: rgba(255, 255, 255, 0.05);
            padding: 10px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 8px;
            overflow-x: auto;
        }

        .page-tab {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .page-tab:hover {
            border-color: #6366f1;
        }

        .page-tab.active {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-color: #6366f1;
        }

        .canvas-content {
            flex: 1;
            overflow: auto;
            padding: 30px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
        }

        .canvas-content::-webkit-scrollbar {
            width: 12px;
            height: 12px;
        }

        .canvas-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .canvas-content::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.5);
            border-radius: 6px;
        }

        .preview-container {
            background: #fff;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.6);
            position: relative;
        }

        .page-canvas {
            position: relative;
            background: transparent;
            overflow: hidden;
        }

        .page-canvas::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #fff;
            z-index: -999;
        }

        /* A4 and A5 sizes at 96 DPI */
        .page-canvas.a4 {
            width: 794px;
            height: 1123px;
        }

        .page-canvas.a5 {
            width: 559px;
            height: 794px;
        }

        /* Right Sidebar - Layers & Properties */
        .right-sidebar {
            width: 300px;
            background: #0a1929;
            border-left: 1px solid rgba(255, 255, 255, 0.1);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .right-sidebar::-webkit-scrollbar {
            width: 8px;
        }

        .right-sidebar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .right-sidebar::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.5);
            border-radius: 4px;
        }

        .layers-section {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .layer-item {
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            margin-bottom: 6px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .layer-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: #6366f1;
        }

        .layer-item.active {
            background: rgba(99, 102, 241, 0.2);
            border-color: #6366f1;
        }

        .layer-name {
            font-size: 12px;
            color: #fff;
            font-weight: 500;
        }

        .layer-controls {
            display: flex;
            gap: 6px;
        }

        .layer-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: #fff;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 10px;
            transition: all 0.2s;
        }

        .layer-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .add-element-section {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .element-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .element-btn {
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
            transition: all 0.3s;
            text-align: center;
        }

        .element-btn:hover {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            border-color: #6366f1;
            transform: translateY(-2px);
        }

        .properties-section {
            padding: 15px;
            flex: 1;
        }

        .color-picker-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .color-input {
            width: 50px;
            height: 40px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            cursor: pointer;
            background: transparent;
        }

        .color-input:hover {
            border-color: #6366f1;
        }

        /* Canvas Elements */
        .canvas-element {
            position: absolute;
            cursor: move;
            border: 2px dashed transparent;
            transition: border 0.2s;
        }

        .canvas-element:hover {
            border-color: #6366f1;
        }

        .canvas-element.selected {
            border-color: #6366f1;
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
        }

        .canvas-element.text-element {
            padding: 10px;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .canvas-element.image-element img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }

        .canvas-element.shape-element svg {
            width: 100%;
            height: 100%;
        }

        .resize-handle {
            position: absolute;
            width: 12px;
            height: 12px;
            background: #6366f1;
            border: 2px solid #fff;
            border-radius: 50%;
            bottom: -6px;
            right: -6px;
            cursor: nwse-resize;
            display: none;
        }

        .canvas-element.selected .resize-handle {
            display: block;
        }

        .delete-handle {
            position: absolute;
            width: 24px;
            height: 24px;
            background: #ef4444;
            border: 2px solid #fff;
            border-radius: 50%;
            top: -12px;
            right: -12px;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-size: 14px;
            font-weight: bold;
        }

        .canvas-element.selected .delete-handle {
            display: flex;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: #0a1929;
            border-radius: 12px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header {
            margin-bottom: 20px;
        }

        .modal-header h3 {
            font-size: 20px;
            color: #6366f1;
            margin-bottom: 8px;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .file-input {
            display: none;
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #6366f1;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Template Styles */
        .template-restaurant {
            background: linear-gradient(135deg, #1a0000 0%, #4a0000 100%);
        }

        .template-market {
            background: linear-gradient(135deg, #004d00 0%, #00b300 100%);
        }

        .template-car {
            background: linear-gradient(135deg, #1a1a1a 0%, #4a4a4a 100%);
        }

        .template-realestate {
            background: linear-gradient(135deg, #003d5c 0%, #006d9c 100%);
        }

        .template-beauty {
            background: linear-gradient(135deg, #4a0033 0%, #8a0060 100%);
        }

        .template-gym {
            background: linear-gradient(135deg, #2d1b00 0%, #5d3b00 100%);
        }

        .template-tech {
            background: linear-gradient(135deg, #001a33 0%, #003d73 100%);
        }

        .template-fashion {
            background: linear-gradient(135deg, #2d002d 0%, #5d005d 100%);
        }

        .template-travel {
            background: linear-gradient(135deg, #002233 0%, #004466 100%);
        }

        .template-education {
            background: linear-gradient(135deg, #1a1a00 0%, #3a3a00 100%);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Left Sidebar -->
        <div class="left-sidebar">
            <div class="logo-header">
                <h1>Brochure Creator</h1>
                <p>Professional Multi-Page Design Tool</p>
            </div>

            <div class="lang-toggle">
                <button class="lang-btn active" onclick="setLanguage('el')" data-lang="el">Î•Î»Î»Î·Î½Î¹ÎºÎ¬</button>
                <button class="lang-btn" onclick="setLanguage('en')" data-lang="en">English</button>
            </div>

            <div class="control-section">
                <div class="section-title">â‘  <span data-i18n="templates">Templates</span></div>
                <div class="template-scroll">
                    <div class="template-item active" onclick="applyTemplate('blank')" data-template="blank">
                        <h4 data-i18n="blank">Blank</h4>
                        <p data-i18n="blankDesc">Start from scratch</p>
                    </div>
                    <div class="template-item" onclick="applyTemplate('restaurant')" data-template="restaurant">
                        <h4 data-i18n="restaurant">Restaurant</h4>
                        <p data-i18n="restaurantDesc">Menu & dining</p>
                    </div>
                    <div class="template-item" onclick="applyTemplate('market')" data-template="market">
                        <h4 data-i18n="market">Supermarket</h4>
                        <p data-i18n="marketDesc">Weekly offers</p>
                    </div>
                    <div class="template-item" onclick="applyTemplate('car')" data-template="car">
                        <h4 data-i18n="car">Car Dealer</h4>
                        <p data-i18n="carDesc">Vehicle showcase</p>
                    </div>
                    <div class="template-item" onclick="applyTemplate('realestate')" data-template="realestate">
                        <h4 data-i18n="realestate">Real Estate</h4>
                        <p data-i18n="realestateDesc">Property listings</p>
                    </div>
                    <div class="template-item" onclick="applyTemplate('beauty')" data-template="beauty">
                        <h4 data-i18n="beauty">Beauty Salon</h4>
                        <p data-i18n="beautyDesc">Services & prices</p>
                    </div>
                    <div class="template-item" onclick="applyTemplate('gym')" data-template="gym">
                        <h4 data-i18n="gym">Fitness Center</h4>
                        <p data-i18n="gymDesc">Memberships</p>
                    </div>
                    <div class="template-item" onclick="applyTemplate('tech')" data-template="tech">
                        <h4 data-i18n="tech">Electronics</h4>
                        <p data-i18n="techDesc">Tech products</p>
                    </div>
                    <div class="template-item" onclick="applyTemplate('fashion')" data-template="fashion">
                        <h4 data-i18n="fashion">Fashion Store</h4>
                        <p data-i18n="fashionDesc">Clothing catalog</p>
                    </div>
                    <div class="template-item" onclick="applyTemplate('travel')" data-template="travel">
                        <h4 data-i18n="travel">Travel Agency</h4>
                        <p data-i18n="travelDesc">Destinations</p>
                    </div>
                    <div class="template-item" onclick="applyTemplate('education')" data-template="education">
                        <h4 data-i18n="education">Education</h4>
                        <p data-i18n="educationDesc">Courses & programs</p>
                    </div>
                </div>
            </div>

            <div class="control-section">
                <div class="section-title">â‘¡ <span data-i18n="paperSize">Paper Size</span></div>
                <div class="size-grid">
                    <button class="size-btn active" onclick="selectPaperSize('a4')" data-size="a4">A4</button>
                    <button class="size-btn" onclick="selectPaperSize('a5')" data-size="a5">A5</button>
                </div>
            </div>

            <div class="control-section">
                <div class="section-title">â‘¢ <span data-i18n="pages">Pages</span></div>
                <div class="page-count-grid">
                    <button class="page-count-btn active" onclick="selectPageCount(1)" data-pages="1">1</button>
                    <button class="page-count-btn" onclick="selectPageCount(2)" data-pages="2">2</button>
                    <button class="page-count-btn" onclick="selectPageCount(4)" data-pages="4">4</button>
                    <button class="page-count-btn" onclick="selectPageCount(8)" data-pages="8">8</button>
                </div>
                <p style="font-size: 10px; color: rgba(255,255,255,0.5); margin-top: 8px; line-height: 1.4;">
                    <span data-i18n="pagesInfo">1=single side, 2=double side, 4=folded, 8=booklet</span>
                </p>
            </div>

            <div class="control-section">
                <button class="btn btn-primary btn-block" onclick="generateBrochure()" style="font-size: 16px; padding: 14px;">
                    <span data-i18n="generate">âœ¨ Generate Brochure</span>
                </button>
            </div>

            <div class="control-section">
                <div class="section-title" data-i18n="export">Export</div>
                <button class="btn btn-primary btn-block" onclick="exportToPDF()">
                    <span data-i18n="exportPDF">ğŸ“„ Export as PDF</span>
                </button>
                <button class="btn btn-primary btn-block" onclick="exportToImages()">
                    <span data-i18n="exportImages">ğŸ–¼ï¸ Export as Images</span>
                </button>
            </div>
        </div>

        <!-- Canvas Area -->
        <div class="canvas-area">
            <div class="canvas-header">
                <h2 data-i18n="workspace">Workspace</h2>
                <div class="canvas-actions">
                    <button class="btn btn-secondary" onclick="zoomOut()">ğŸ”-</button>
                    <button class="btn btn-secondary" onclick="zoomReset()">100%</button>
                    <button class="btn btn-secondary" onclick="zoomIn()">ğŸ”+</button>
                </div>
            </div>

            <div class="pages-nav" id="pagesNav">
                <button class="page-tab active" onclick="switchPage(0)">
                    <span data-i18n="page">Page</span> 1
                </button>
            </div>

            <div class="canvas-content" id="canvasContent">
                <div class="preview-container">
                    <div class="page-canvas a4" id="pageCanvas0" data-page="0"></div>
                </div>
            </div>
        </div>

        <!-- Right Sidebar -->
        <div class="right-sidebar">
            <div class="add-element-section">
                <div class="section-title" data-i18n="addElements">Add Elements</div>
                <div class="element-grid">
                    <button class="element-btn" onclick="addTextElement()">
                        <span data-i18n="addText">ğŸ“ Text</span>
                    </button>
                    <button class="element-btn" onclick="openImageUpload('image')">
                        <span data-i18n="addImage">ğŸ–¼ï¸ Image</span>
                    </button>
                    <button class="element-btn" onclick="openImageUpload('background')">
                        <span data-i18n="addBg">ğŸ¨ Background</span>
                    </button>
                    <button class="element-btn" onclick="openImageUpload('logo')">
                        <span data-i18n="addLogo">ğŸ¢ Logo</span>
                    </button>
                </div>
            </div>

            <div class="layers-section">
                <div class="section-title" data-i18n="layers">Layers</div>
                <div id="layersList"></div>
            </div>

            <div class="properties-section">
                <div class="section-title" data-i18n="properties">Properties</div>
                <div id="propertiesPanel">
                    <p style="font-size: 12px; color: rgba(255,255,255,0.5); text-align: center; margin-top: 20px;" data-i18n="selectElement">
                        Select an element to edit
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Upload Modal -->
    <div class="modal" id="imageUploadModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 data-i18n="uploadImage">Upload Image</h3>
            </div>
            <div class="modal-body">
                <input type="file" id="imageFileInput" class="file-input" accept="image/*" onchange="handleImageUpload(event)">
                <button class="btn btn-primary btn-block" onclick="document.getElementById('imageFileInput').click()">
                    <span data-i18n="chooseFile">Choose File</span>
                </button>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeImageUpload()">
                    <span data-i18n="cancel">Cancel</span>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Translations
        const translations = {
            el: {
                templates: 'Î ÏÏŒÏ„Ï…Ï€Î±',
                paperSize: 'ÎœÎ­Î³ÎµÎ¸Î¿Ï‚ Î§Î±ÏÏ„Î¹Î¿Ï',
                pages: 'Î£ÎµÎ»Î¯Î´ÎµÏ‚',
                pagesInfo: '1=Î¼Î¿Î½Î® ÏŒÏˆÎ·, 2=Î´Î¹Ï€Î»Î® ÏŒÏˆÎ·, 4=Î´Î¹Ï€Î»Ï‰Î¼Î­Î½Î¿, 8=Î²Î¹Î²Î»Î¹Î¬ÏÎ¹Î¿',
                generate: 'âœ¨ Î”Î·Î¼Î¹Î¿Ï…ÏÎ³Î¯Î± Brochure',
                blank: 'ÎšÎµÎ½ÏŒ',
                blankDesc: 'ÎÎµÎºÎ¹Î½Î®ÏƒÏ„Îµ Î±Ï€ÏŒ Ï„Î·Î½ Î±ÏÏ‡Î®',
                restaurant: 'Î•ÏƒÏ„Î¹Î±Ï„ÏŒÏÎ¹Î¿',
                restaurantDesc: 'ÎœÎµÎ½Î¿Ï & ÎµÏƒÏ„Î¯Î±ÏƒÎ·',
                market: 'Î£Î¿ÏÏ€ÎµÏ ÎœÎ¬ÏÎºÎµÏ„',
                marketDesc: 'Î•Î²Î´Î¿Î¼Î±Î´Î¹Î±Î¯ÎµÏ‚ Ï€ÏÎ¿ÏƒÏ†Î¿ÏÎ­Ï‚',
                car: 'Î‘Î½Ï„Î¹Ï€ÏÎ¿ÏƒÏ‰Ï€ÎµÎ¯Î± Î‘Ï…Ï„Î¿ÎºÎ¹Î½Î®Ï„Ï‰Î½',
                carDesc: 'Î Î±ÏÎ¿Ï…ÏƒÎ¯Î±ÏƒÎ· Î¿Ï‡Î·Î¼Î¬Ï„Ï‰Î½',
                realestate: 'ÎœÎµÏƒÎ¹Ï„Î¹ÎºÏŒ Î“ÏÎ±Ï†ÎµÎ¯Î¿',
                realestateDesc: 'ÎšÎ±Ï„Î±Ï‡Ï‰ÏÎ®ÏƒÎµÎ¹Ï‚ Î±ÎºÎ¹Î½Î®Ï„Ï‰Î½',
                beauty: 'ÎšÎ¿Î¼Î¼Ï‰Ï„Î®ÏÎ¹Î¿',
                beautyDesc: 'Î¥Ï€Î·ÏÎµÏƒÎ¯ÎµÏ‚ & Ï„Î¹Î¼Î­Ï‚',
                gym: 'Î“Ï…Î¼Î½Î±ÏƒÏ„Î®ÏÎ¹Î¿',
                gymDesc: 'Î£Ï…Î½Î´ÏÎ¿Î¼Î­Ï‚',
                tech: 'Î—Î»ÎµÎºÏ„ÏÎ¿Î½Î¹ÎºÎ¬',
                techDesc: 'Î¤ÎµÏ‡Î½Î¿Î»Î¿Î³Î¹ÎºÎ¬ Ï€ÏÎ¿ÏŠÏŒÎ½Ï„Î±',
                fashion: 'ÎšÎ±Ï„Î¬ÏƒÏ„Î·Î¼Î± Î¡Î¿ÏÏ‡Ï‰Î½',
                fashionDesc: 'ÎšÎ±Ï„Î¬Î»Î¿Î³Î¿Ï‚ ÏÎ¿ÏÏ‡Ï‰Î½',
                travel: 'Î¤Î±Î¾Î¹Î´Î¹Ï‰Ï„Î¹ÎºÏŒ Î“ÏÎ±Ï†ÎµÎ¯Î¿',
                travelDesc: 'Î ÏÎ¿Î¿ÏÎ¹ÏƒÎ¼Î¿Î¯',
                education: 'Î•ÎºÏ€Î±Î¯Î´ÎµÏ…ÏƒÎ·',
                educationDesc: 'ÎœÎ±Î¸Î®Î¼Î±Ï„Î± & Ï€ÏÎ¿Î³ÏÎ¬Î¼Î¼Î±Ï„Î±',
                export: 'Î•Î¾Î±Î³Ï‰Î³Î®',
                exportPDF: 'ğŸ“„ Î•Î¾Î±Î³Ï‰Î³Î® ÏƒÎµ PDF',
                exportImages: 'ğŸ–¼ï¸ Î•Î¾Î±Î³Ï‰Î³Î® ÏƒÎµ Î•Î¹ÎºÏŒÎ½ÎµÏ‚',
                workspace: 'Î§ÏÏÎ¿Ï‚ Î•ÏÎ³Î±ÏƒÎ¯Î±Ï‚',
                page: 'Î£ÎµÎ»Î¯Î´Î±',
                addElements: 'Î ÏÎ¿ÏƒÎ¸Î®ÎºÎ· Î£Ï„Î¿Î¹Ï‡ÎµÎ¯Ï‰Î½',
                addText: 'ğŸ“ ÎšÎµÎ¯Î¼ÎµÎ½Î¿',
                addImage: 'ğŸ–¼ï¸ Î•Î¹ÎºÏŒÎ½Î±',
                addBg: 'ğŸ¨ Î¦ÏŒÎ½Ï„Î¿',
                addLogo: 'ğŸ¢ Î›Î¿Î³ÏŒÏ„Ï…Ï€Î¿',
                layers: 'Î•Ï€Î¯Ï€ÎµÎ´Î±',
                properties: 'Î™Î´Î¹ÏŒÏ„Î·Ï„ÎµÏ‚',
                selectElement: 'Î•Ï€Î¹Î»Î­Î¾Ï„Îµ Î­Î½Î± ÏƒÏ„Î¿Î¹Ï‡ÎµÎ¯Î¿ Î³Î¹Î± ÎµÏ€ÎµÎ¾ÎµÏÎ³Î±ÏƒÎ¯Î±',
                uploadImage: 'Î‘Î½Î­Î²Î±ÏƒÎ¼Î± Î•Î¹ÎºÏŒÎ½Î±Ï‚',
                chooseFile: 'Î•Ï€Î¹Î»Î¿Î³Î® Î‘ÏÏ‡ÎµÎ¯Î¿Ï…',
                cancel: 'Î‘ÎºÏÏÏ‰ÏƒÎ·',
                text: 'ÎšÎµÎ¯Î¼ÎµÎ½Î¿',
                fontSize: 'ÎœÎ­Î³ÎµÎ¸Î¿Ï‚ Î“ÏÎ±Î¼Î¼Î±Ï„Î¿ÏƒÎµÎ¹ÏÎ¬Ï‚',
                fontFamily: 'Î“ÏÎ±Î¼Î¼Î±Ï„Î¿ÏƒÎµÎ¹ÏÎ¬',
                textColor: 'Î§ÏÏÎ¼Î± ÎšÎµÎ¹Î¼Î­Î½Î¿Ï…',
                backgroundColor: 'Î§ÏÏÎ¼Î± Î¦ÏŒÎ½Ï„Î¿Ï…',
                width: 'Î Î»Î¬Ï„Î¿Ï‚',
                height: 'ÎÏˆÎ¿Ï‚',
                opacity: 'Î”Î¹Î±Ï†Î¬Î½ÎµÎ¹Î±',
                rotation: 'Î ÎµÏÎ¹ÏƒÏ„ÏÎ¿Ï†Î®'
            },
            en: {
                templates: 'Templates',
                paperSize: 'Paper Size',
                pages: 'Pages',
                pagesInfo: '1=single side, 2=double side, 4=folded, 8=booklet',
                generate: 'âœ¨ Generate Brochure',
                blank: 'Blank',
                blankDesc: 'Start from scratch',
                restaurant: 'Restaurant',
                restaurantDesc: 'Menu & dining',
                market: 'Supermarket',
                marketDesc: 'Weekly offers',
                car: 'Car Dealer',
                carDesc: 'Vehicle showcase',
                realestate: 'Real Estate',
                realestateDesc: 'Property listings',
                beauty: 'Beauty Salon',
                beautyDesc: 'Services & prices',
                gym: 'Fitness Center',
                gymDesc: 'Memberships',
                tech: 'Electronics',
                techDesc: 'Tech products',
                fashion: 'Fashion Store',
                fashionDesc: 'Clothing catalog',
                travel: 'Travel Agency',
                travelDesc: 'Destinations',
                education: 'Education',
                educationDesc: 'Courses & programs',
                export: 'Export',
                exportPDF: 'ğŸ“„ Export as PDF',
                exportImages: 'ğŸ–¼ï¸ Export as Images',
                workspace: 'Workspace',
                page: 'Page',
                addElements: 'Add Elements',
                addText: 'ğŸ“ Text',
                addImage: 'ğŸ–¼ï¸ Image',
                addBg: 'ğŸ¨ Background',
                addLogo: 'ğŸ¢ Logo',
                layers: 'Layers',
                properties: 'Properties',
                selectElement: 'Select an element to edit',
                uploadImage: 'Upload Image',
                chooseFile: 'Choose File',
                cancel: 'Cancel',
                text: 'Text',
                fontSize: 'Font Size',
                fontFamily: 'Font Family',
                textColor: 'Text Color',
                backgroundColor: 'Background Color',
                width: 'Width',
                height: 'Height',
                opacity: 'Opacity',
                rotation: 'Rotation'
            }
        };

        // Global State
        let currentLang = 'el';
        let selectedTemplate = 'blank';
        let selectedPaperSize = 'a4';
        let selectedPages = 1;
        let currentPage = 0;
        let zoom = 1;
        let selectedElement = null;
        let currentImageType = null;
        let elementIdCounter = 0;
        let brochureGenerated = false;

        // Page data structure
        let pages = [
            { elements: [] }
        ];

        // Initialize
        function init() {
            // Start with blank canvas
            updatePageTabs();
            updateLayers();
            setupDragAndDrop();
        }

        // Selection Functions
        function applyTemplate(template) {
            selectedTemplate = template;
            document.querySelectorAll('.template-item').forEach(item => {
                item.classList.toggle('active', item.dataset.template === template);
            });
        }

        function selectPaperSize(size) {
            selectedPaperSize = size;
            document.querySelectorAll('.size-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.size === size);
            });
        }

        function selectPageCount(count) {
            selectedPages = count;
            document.querySelectorAll('.page-count-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.pages == count);
            });
        }

        function generateBrochure() {
            brochureGenerated = true;

            // Reset pages
            pages = [];
            for (let i = 0; i < selectedPages; i++) {
                pages.push({ elements: [] });
            }

            currentPage = 0;
            elementIdCounter = 0;

            // Load template content
            loadTemplateContent(selectedTemplate, selectedPages);

            // Update UI
            updatePageTabs();
            renderCurrentPage();
        }

        // Language Management
        function setLanguage(lang) {
            currentLang = lang;
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.lang === lang);
            });
            updateTranslations();
        }

        function updateTranslations() {
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.dataset.i18n;
                if (translations[currentLang][key]) {
                    el.textContent = translations[currentLang][key];
                }
            });
        }

        // Page Management
        function updatePageTabs() {
            const nav = document.getElementById('pagesNav');
            nav.innerHTML = '';

            for (let i = 0; i < pages.length; i++) {
                const tab = document.createElement('button');
                tab.className = `page-tab ${i === currentPage ? 'active' : ''}`;
                tab.onclick = () => switchPage(i);
                tab.innerHTML = `<span data-i18n="page">${translations[currentLang].page}</span> ${i + 1}`;
                nav.appendChild(tab);
            }
        }

        function switchPage(pageIndex) {
            currentPage = pageIndex;
            document.querySelectorAll('.page-tab').forEach((tab, idx) => {
                tab.classList.toggle('active', idx === pageIndex);
            });
            renderCurrentPage();
        }

        function renderCurrentPage() {
            const container = document.getElementById('canvasContent');
            container.innerHTML = '';

            const preview = document.createElement('div');
            preview.className = 'preview-container';

            const canvas = document.createElement('div');
            canvas.className = `page-canvas ${selectedPaperSize}`;
            canvas.id = `pageCanvas${currentPage}`;
            canvas.dataset.page = currentPage;

            // Apply template background
            if (selectedTemplate !== 'blank') {
                canvas.classList.add(`template-${selectedTemplate}`);
            }

            // Render elements - sort by z-index to ensure proper layering
            const pageData = pages[currentPage];
            const sortedElements = [...pageData.elements].sort((a, b) => (a.zIndex || 1) - (b.zIndex || 1));
            sortedElements.forEach(element => {
                const el = createElementDOM(element);
                canvas.appendChild(el);
            });

            preview.appendChild(canvas);
            container.appendChild(preview);

            updateLayers();
        }

        // SVG Shape Helpers
        function createCurveShape(color, opacity = 0.3) {
            return `<svg viewBox="0 0 800 1200" xmlns="http://www.w3.org/2000/svg">
                <path d="M 0 200 Q 400 100 800 200 L 800 400 Q 400 300 0 400 Z" fill="${color}" opacity="${opacity}"/>
            </svg>`;
        }

        function createWaveShape(color, opacity = 0.3) {
            return `<svg viewBox="0 0 800 1200" xmlns="http://www.w3.org/2000/svg">
                <path d="M 0 100 Q 200 50 400 100 T 800 100 L 800 200 Q 600 250 400 200 T 0 200 Z" fill="${color}" opacity="${opacity}"/>
            </svg>`;
        }

        function createCirclePattern(color, opacity = 0.2) {
            return `<svg viewBox="0 0 800 1200" xmlns="http://www.w3.org/2000/svg">
                <circle cx="700" cy="100" r="150" fill="${color}" opacity="${opacity}"/>
                <circle cx="100" cy="1000" r="200" fill="${color}" opacity="${opacity * 0.7}"/>
            </svg>`;
        }

        function createDiagonalLines(color, opacity = 0.1) {
            return `<svg viewBox="0 0 800 1200" xmlns="http://www.w3.org/2000/svg">
                <line x1="0" y1="0" x2="800" y2="300" stroke="${color}" stroke-width="40" opacity="${opacity}"/>
                <line x1="0" y1="200" x2="800" y2="500" stroke="${color}" stroke-width="40" opacity="${opacity}"/>
            </svg>`;
        }

        function createGeometricPattern(color, opacity = 0.15) {
            return `<svg viewBox="0 0 800 1200" xmlns="http://www.w3.org/2000/svg">
                <polygon points="800,0 800,300 600,300" fill="${color}" opacity="${opacity}"/>
                <polygon points="0,900 200,900 0,1200" fill="${color}" opacity="${opacity * 0.8}"/>
                <circle cx="750" cy="1100" r="100" fill="${color}" opacity="${opacity * 0.6}"/>
            </svg>`;
        }

        function createFloralCurves(color, opacity = 0.2) {
            return `<svg viewBox="0 0 800 1200" xmlns="http://www.w3.org/2000/svg">
                <path d="M 800 0 Q 600 200 800 400 Z" fill="${color}" opacity="${opacity}"/>
                <path d="M 0 800 Q 200 1000 0 1200 Z" fill="${color}" opacity="${opacity}"/>
                <circle cx="100" cy="100" r="80" fill="none" stroke="${color}" stroke-width="3" opacity="${opacity * 1.5}"/>
                <circle cx="700" cy="1000" r="100" fill="none" stroke="${color}" stroke-width="3" opacity="${opacity * 1.5}"/>
            </svg>`;
        }

        function createModernArcs(color, opacity = 0.25) {
            return `<svg viewBox="0 0 800 1200" xmlns="http://www.w3.org/2000/svg">
                <path d="M -100 600 Q 200 400 400 600 T 900 600" fill="none" stroke="${color}" stroke-width="100" opacity="${opacity}"/>
                <path d="M -100 200 Q 200 100 500 200" fill="none" stroke="${color}" stroke-width="60" opacity="${opacity * 0.7}"/>
                <path d="M 300 1200 Q 500 1000 700 1200" fill="none" stroke="${color}" stroke-width="80" opacity="${opacity * 0.8}"/>
            </svg>`;
        }


        function loadTemplateContent(template, pageCount) {
            // Template configurations
            const templates = {
                restaurant: {
                    color1: '#8b0000',
                    color2: '#ffd700',
                    title: currentLang === 'el' ? 'Î•Î£Î¤Î™Î‘Î¤ÎŸÎ¡Î™ÎŸ' : 'RESTAURANT',
                    subtitle: currentLang === 'el' ? 'Î“ÎµÏÏƒÎµÎ¹Ï‚ Ï€Î¿Ï… Î¸Ï…Î¼Î¬ÏƒÏ„Îµ' : 'Tastes you remember',
                    content: {
                        1: [currentLang === 'el' ? 'Î•Î¹Î´Î¹ÎºÏŒ ÎœÎµÎ½Î¿Ï Î—Î¼Î­ÏÎ±Ï‚\n\nÎŸÏÎµÎºÏ„Î¹ÎºÎ¬ â€¢ ÎšÏÏÎ¹Î± â€¢ Î“Î»Ï…ÎºÎ¬\n\nÎ¤Î·Î»: 210-1234567' : 'Daily Special Menu\n\nAppetizers â€¢ Mains â€¢ Desserts\n\nTel: 210-1234567'],
                        2: [
                            currentLang === 'el' ? 'Î•Î£Î¤Î™Î‘Î¤ÎŸÎ¡Î™ÎŸ\n\nÎ“ÎµÏÏƒÎµÎ¹Ï‚ Ï€Î¿Ï… Î¸Ï…Î¼Î¬ÏƒÏ„Îµ' : 'RESTAURANT\n\nTastes you remember',
                            currentLang === 'el' ? 'ÎŸÎ¡Î•ÎšÎ¤Î™ÎšÎ‘\n\nÎ£Î±Î»Î¬Ï„Î± Î£ÎµÏ† ..................... 8â‚¬\nÎ¤Î¶Î±Ï„Î¶Î¯ÎºÎ¹ ............................ 5â‚¬\nÎ£Ï€Î±Î½Î±ÎºÏŒÏ€Î¹Ï„Î± .................... 6â‚¬\n\nÎ¤Î·Î»: 210-1234567' : 'APPETIZERS\n\nChef Salad ......................... â‚¬8\nTzatziki .............................. â‚¬5\nSpinach Pie ....................... â‚¬6\n\nTel: 210-1234567'
                        ],
                        4: [
                            currentLang === 'el' ? 'Î•Î£Î¤Î™Î‘Î¤ÎŸÎ¡Î™ÎŸ\n\nÎ“ÎµÏÏƒÎµÎ¹Ï‚ Ï€Î¿Ï…\nÎ¸Ï…Î¼Î¬ÏƒÏ„Îµ' : 'RESTAURANT\n\nTastes you\nremember',
                            currentLang === 'el' ? 'ÎŸÎ¡Î•ÎšÎ¤Î™ÎšÎ‘\n\nÎ£Î±Î»Î¬Ï„Î± Î£ÎµÏ† ........... 8â‚¬\nÎ¤Î¶Î±Ï„Î¶Î¯ÎºÎ¹ ................. 5â‚¬\nÎ£Ï€Î±Î½Î±ÎºÏŒÏ€Î¹Ï„Î± .......... 6â‚¬\nÎšÎ¿Î»Î¿ÎºÏ…Î¸Î¬ÎºÎ¹Î± ......... 7â‚¬' : 'APPETIZERS\n\nChef Salad .............. â‚¬8\nTzatziki ................... â‚¬5\nSpinach Pie ............ â‚¬6\nZucchini  ................. â‚¬7',
                            currentLang === 'el' ? 'ÎšÎ¥Î¡Î™Î‘ Î Î™Î‘Î¤Î‘\n\nÎœÎ¿ÏƒÏ‡Î±ÏÎ¬ÎºÎ¹ ............ 16â‚¬\nÎ¨Î¬ÏÎ¹ ÏƒÏ„Î· ÏƒÏ‡Î¬ÏÎ± ... 18â‚¬\nÎšÎ¿Ï„ÏŒÏ€Î¿Ï…Î»Î¿ ............ 12â‚¬\nÎœÎ¿Ï…ÏƒÎ±ÎºÎ¬Ï‚ ............. 14â‚¬' : 'MAIN COURSES\n\nLemon Veal ........... â‚¬16\nGrilled Fish ........... â‚¬18\nChicken ................. â‚¬12\nMoussaka .............. â‚¬14',
                            currentLang === 'el' ? 'Î“Î›Î¥ÎšÎ‘\n\nÎœÏ€Î±ÎºÎ»Î±Î²Î¬Ï‚ ............. 6â‚¬\nÎ Î±Î³Ï‰Ï„ÏŒ .................... 5â‚¬\nÎ“Î±Î»Î±ÎºÏ„Î¿Î¼Ï€. ............ 6â‚¬\n\nğŸ“ 210-1234567\nğŸŒ restaurant.gr' : 'DESSERTS\n\nBaklava .................... â‚¬6\nIce Cream ................ â‚¬5\nGalaktob. ................. â‚¬6\n\nğŸ“ 210-1234567\nğŸŒ restaurant.gr'
                        ],
                        8: [
                            currentLang === 'el' ? 'Î•Î£Î¤Î™Î‘Î¤ÎŸÎ¡Î™ÎŸ\n\nÎ“ÎµÏÏƒÎµÎ¹Ï‚ Ï€Î¿Ï…\nÎ¸Ï…Î¼Î¬ÏƒÏ„Îµ' : 'RESTAURANT\n\nTastes you\nremember',
                            currentLang === 'el' ? 'ÎŸÎ¡Î•ÎšÎ¤Î™ÎšÎ‘\n\nÎ£Î±Î»Î¬Ï„Î± Î£ÎµÏ† ....... 8â‚¬\nÎ¤Î¶Î±Ï„Î¶Î¯ÎºÎ¹ ............. 5â‚¬\nÎ£Ï€Î±Î½Î±ÎºÏŒÏ€Î¹Ï„Î± ...... 6â‚¬\nÎšÎ¿Î»Î¿ÎºÏ…Î¸Î¬ÎºÎ¹Î± ..... 7â‚¬\nÎœÎµÎ»Î¹Ï„Î¶Î¬Î½ÎµÏ‚ ........ 6â‚¬' : 'APPETIZERS\n\nChef Salad .......... â‚¬8\nTzatziki ............... â‚¬5\nSpinach Pie ........ â‚¬6\nZucchini .............. â‚¬7\nEggplant ............. â‚¬6',
                            currentLang === 'el' ? 'Î£ÎŸÎ¥Î Î•Î£\n\nÎ¦Î±ÎºÎ­Ï‚ ................. 5â‚¬\nÎ¨Î±ÏÏŒÏƒÎ¿Ï…Ï€Î± ....... 8â‚¬\nÎšÎ¿Ï„ÏŒÏƒÎ¿Ï…Ï€Î± ........ 6â‚¬' : 'SOUPS\n\nLentils ................ â‚¬5\nFish Soup ........... â‚¬8\nChicken Soup ..... â‚¬6',
                            currentLang === 'el' ? 'ÎšÎ¥Î¡Î™Î‘ Î Î™Î‘Î¤Î‘\n\nÎœÎ¿ÏƒÏ‡Î±ÏÎ¬ÎºÎ¹ ........ 16â‚¬\nÎ¨Î¬ÏÎ¹ .................. 18â‚¬\nÎšÎ¿Ï„ÏŒÏ€Î¿Ï…Î»Î¿ ........ 12â‚¬\nÎœÎ¿Ï…ÏƒÎ±ÎºÎ¬Ï‚ ......... 14â‚¬\nÎ Î±ÏŠÎ´Î¬ÎºÎ¹Î± ........... 17â‚¬' : 'MAIN COURSES\n\nVeal ................... â‚¬16\nFish .................... â‚¬18\nChicken .............. â‚¬12\nMoussaka ........... â‚¬14\nLamb Chops ...... â‚¬17',
                            currentLang === 'el' ? 'Î–Î¥ÎœÎ‘Î¡Î™ÎšÎ‘\n\nÎšÎ±ÏÎ¼Ï€Î¿Î½Î¬ÏÎ± ..... 11â‚¬\nÎœÏ€Î¿Î»Î¿Î½Î­Î¶ ......... 10â‚¬\nÎ‘ÏÏÎ±Î¼Ï€Î¹Î¬Ï„Î± ...... 10â‚¬' : 'PASTA\n\nCarbonara ......... â‚¬11\nBolognese ......... â‚¬10\nArrabbiata ......... â‚¬10',
                            currentLang === 'el' ? 'Î Î™Î¤Î£Î•Î£\n\nÎœÎ±ÏÎ³Î±ÏÎ¯Ï„Î± ......... 9â‚¬\nÎ ÎµÏ€ÎµÏÏŒÎ½Î¹ ........... 11â‚¬\n4 Î¤Ï…ÏÎ¹Î¬ .............. 12â‚¬' : 'PIZZAS\n\nMargherita ......... â‚¬9\nPepperoni .......... â‚¬11\n4 Cheeses ........... â‚¬12',
                            currentLang === 'el' ? 'Î£Î‘Î›Î‘Î¤Î•Î£\n\nÎ§Ï‰ÏÎ¹Î¬Ï„Î¹ÎºÎ· .......... 7â‚¬\nÎšÎ±Î¯ÏƒÎ±ÏÎ± ............. 8â‚¬\nÎ ÏÎ¬ÏƒÎ¹Î½Î· ............. 6â‚¬' : 'SALADS\n\nGreek ................. â‚¬7\nCaesar ................ â‚¬8\nGreen ................. â‚¬6',
                            currentLang === 'el' ? 'Î“Î›Î¥ÎšÎ‘ & ÎšÎ‘Î¦Î•Î”Î•Î£\n\nÎœÏ€Î±ÎºÎ»Î±Î²Î¬Ï‚ ........ 6â‚¬\nÎ Î±Î³Ï‰Ï„ÏŒ ............... 5â‚¬\nÎšÏÎ­Î¼Î± ................. 5â‚¬\nÎ•ÏƒÏ€ÏÎ­ÏƒÎ¿ .............. 3â‚¬\nÎšÎ±Ï€Î¿Ï…Ï„ÏƒÎ¯Î½Î¿ ........ 4â‚¬\n\nğŸ“ 210-1234567\nğŸŒ restaurant.gr' : 'DESSERTS & COFFEE\n\nBaklava ............... â‚¬6\nIce Cream ............ â‚¬5\nCreme .................. â‚¬5\nEspresso .............. â‚¬3\nCappuccino ......... â‚¬4\n\nğŸ“ 210-1234567\nğŸŒ restaurant.gr'
                        ]
                    }
                },
                market: {
                    color1: '#004d00',
                    color2: '#ffff00',
                    title: currentLang === 'el' ? 'Î Î¡ÎŸÎ£Î¦ÎŸÎ¡Î•Î£' : 'SPECIAL OFFERS',
                    subtitle: currentLang === 'el' ? 'Î•ÎºÏ€Ï„ÏÏƒÎµÎ¹Ï‚ Î­Ï‰Ï‚ 50%' : 'Discounts up to 50%',
                    content: {
                        1: [currentLang === 'el' ? 'Î•Î’Î”ÎŸÎœÎ‘Î”Î™Î‘Î™Î•Î£ Î Î¡ÎŸÎ£Î¦ÎŸÎ¡Î•Î£\n\nÎ¦ÏÎ¿ÏÏ„Î± & Î›Î±Ï‡Î±Î½Î¹ÎºÎ¬ -40%\nÎ“Î±Î»Î±ÎºÏ„Î¿ÎºÎ¿Î¼Î¹ÎºÎ¬ -30%\n\nÎ¤Î·Î»: 210-9876543' : 'WEEKLY OFFERS\n\nFruits & Vegetables -40%\nDairy Products -30%\n\nTel: 210-9876543'],
                        2: [
                            currentLang === 'el' ? 'Î Î¡ÎŸÎ£Î¦ÎŸÎ¡Î•Î£\n\nÎ•ÎºÏ€Ï„ÏÏƒÎµÎ¹Ï‚\nÎ­Ï‰Ï‚ 50%' : 'OFFERS\n\nDiscounts\nup to 50%',
                            currentLang === 'el' ? 'Î¤Î¡ÎŸÎ¦Î™ÎœÎ‘\n\nÎ“Î¬Î»Î± 1.5L .................... -30%\nÎ¨Ï‰Î¼Î¯ ÎŸÎ»Î¹ÎºÎ®Ï‚ ................ -25%\nÎ¦ÏÎ­ÏƒÎºÎ± Î›Î±Ï‡Î±Î½Î¹ÎºÎ¬ ........ -40%\nÎ¤Ï…ÏÎ¯ Î¦Î­Ï„Î± .................... -20%\n\nğŸ“ 210-9876543' : 'GROCERIES\n\nMilk 1.5L ......................... -30%\nWhole Wheat Bread ........ -25%\nFresh Vegetables ............ -40%\nFeta Cheese ..................... -20%\n\nğŸ“ 210-9876543'
                        ],
                        4: [
                            currentLang === 'el' ? 'Î Î¡ÎŸÎ£Î¦ÎŸÎ¡Î•Î£\n\nÎ•ÎºÏ€Ï„ÏÏƒÎµÎ¹Ï‚\nÎ­Ï‰Ï‚ 50%' : 'OFFERS\n\nDiscounts\nup to 50%',
                            currentLang === 'el' ? 'Î¤Î¡ÎŸÎ¦Î™ÎœÎ‘\n\nÎ“Î¬Î»Î± 1.5L ......... -30%\nÎ¨Ï‰Î¼Î¯ ÎŸÎ»Î¹ÎºÎ®Ï‚ .... -25%\nÎ›Î±Ï‡Î±Î½Î¹ÎºÎ¬ ......... -40%\nÎ¤Ï…ÏÎ¯ Î¦Î­Ï„Î± ......... -20%' : 'GROCERIES\n\nMilk 1.5L ............ -30%\nWheat Bread ..... -25%\nVegetables ........ -40%\nFeta Cheese ....... -20%',
                            currentLang === 'el' ? 'ÎŸÎ™ÎšÎ™Î‘ÎšÎ‘\n\nÎ‘Ï€Î¿ÏÏÏ…Ï€Î±Î½Ï„Î¹ÎºÏŒ . -45%\nÎ§Î±ÏÏ„Î¯ Î¥Î³ÎµÎ¯Î±Ï‚ ..... -30%\nÎ£Ï†Î¿Ï…Î³Î³Î¬ÏÎ¹ ........ -25%' : 'HOUSEHOLD\n\nDetergent .......... -45%\nToilet Paper ...... -30%\nSponge .............. -25%',
                            currentLang === 'el' ? 'Î‘Î›Î›Î‘\n\nÎ£Î±Î¼Ï€Î¿Ï…Î¬Î½ ......... -35%\nÎŸÎ´Î¿Î½Ï„ÏŒÎºÏÎµÎ¼Î± ... -30%\n\nğŸ“ 210-9876543\nÎŠÏƒÏ‡ÏÎµÎ¹: 30/12' : 'OTHER\n\nShampoo ........... -35%\nToothpaste ........ -30%\n\nğŸ“ 210-9876543\nValid: 30/12'
                        ],
                        8: [
                            currentLang === 'el' ? 'Î Î¡ÎŸÎ£Î¦ÎŸÎ¡Î•Î£\n\nÎ•ÎºÏ€Ï„ÏÏƒÎµÎ¹Ï‚\nÎ­Ï‰Ï‚ 50%' : 'OFFERS\n\nDiscounts\nup to 50%',
                            currentLang === 'el' ? 'Î¤Î¡ÎŸÎ¦Î™ÎœÎ‘\n\nÎ“Î¬Î»Î± 1.5L ...... -30%\nÎ¨Ï‰Î¼Î¯ .............. -25%\nÎ›Î±Ï‡Î±Î½Î¹ÎºÎ¬ ........ -40%\nÎ¤Ï…ÏÎ¯ ................ -20%' : 'GROCERIES\n\nMilk 1.5L ...... -30%\nBread ............. -25%\nVegetables ..... -40%\nCheese ............ -20%',
                            currentLang === 'el' ? 'ÎšÎ¡Î•Î‘Î¤Î‘\n\nÎšÎ¿Ï„ÏŒÏ€Î¿Ï…Î»Î¿ ... -35%\nÎœÎ¿ÏƒÏ‡Î¬ÏÎ¹ ........ -30%\nÎ§Î¿Î¹ÏÎ¹Î½ÏŒ ......... -32%' : 'MEATS\n\nChicken ........ -35%\nBeef .............. -30%\nPork .............. -32%',
                            currentLang === 'el' ? 'Î¨Î‘Î¡Î™Î‘\n\nÎ›Î±Ï…ÏÎ¬ÎºÎ¹ ......... -40%\nÎ¤ÏƒÎ¹Ï€Î¿ÏÏÎ± ...... -38%\nÎ“Î±ÏÎ¯Î´ÎµÏ‚ ......... -35%' : 'FISH\n\nSea Bass ...... -40%\nSea Bream ... -38%\nShrimp .......... -35%',
                            currentLang === 'el' ? 'ÎŸÎ™ÎšÎ™Î‘ÎšÎ‘\n\nÎ‘Ï€Î¿ÏÏÏ…Ï€. ..... -45%\nÎ§Î±ÏÏ„Î¯ Î¥Î³. ...... -30%\nÎ£Ï†Î¿Ï…Î³Î³Î¬ÏÎ¹ .... -25%' : 'HOUSEHOLD\n\nDetergent ..... -45%\nToilet Paper . -30%\nSponge .......... -25%',
                            currentLang === 'el' ? 'Î¦Î¡ÎŸÎÎ¤Î™Î”Î‘\n\nÎ£Î±Î¼Ï€Î¿Ï…Î¬Î½ .... -35%\nÎŸÎ´Î¿Î½Ï„ÏŒÎºÏ. .... -30%\nÎ£Î±Ï€Î¿ÏÎ½Î¹ ........ -28%' : 'PERSONAL\n\nShampoo ..... -35%\nToothpaste ... -30%\nSoap ............. -28%',
                            currentLang === 'el' ? 'Î ÎŸÎ¤Î‘\n\nÎ§Ï…Î¼Î¿Î¯ ............ -25%\nÎ‘Î½Î±ÏˆÏ…ÎºÏ„Î¹ÎºÎ¬ .. -20%\nÎÎµÏÎ¬ ............. -15%' : 'DRINKS\n\nJuices ........... -25%\nSoft Drinks ... -20%\nWater ............ -15%',
                            currentLang === 'el' ? 'Î“Î›Î¥ÎšÎ‘\n\nÎ£Î¿ÎºÎ¿Î»Î¬Ï„ÎµÏ‚ .... -30%\nÎœÏ€Î¹ÏƒÎºÏŒÏ„Î± ...... -25%\nÎ¤ÏƒÎ¯Ï‡Î»ÎµÏ‚ ......... -20%' : 'SWEETS\n\nChocolates ... -30%\nCookies ......... -25%\nGum .............. -20%',
                            currentLang === 'el' ? 'Î•Î Î™ÎšÎŸÎ™ÎÎ©ÎÎ™Î‘\n\nğŸ“ 210-9876543\nğŸ“§ info@market.gr\n\nÎŠÏƒÏ‡ÏÎµÎ¹ Î­Ï‰Ï‚:\n30/12/2024' : 'CONTACT\n\nğŸ“ 210-9876543\nğŸ“§ info@market.gr\n\nValid until:\n30/12/2024'
                        ]
                    }
                },
                // Add other templates here (car, realestate, beauty, gym, tech, fashion, travel, education)
                blank: {
                    color1: '#ffffff',
                    color2: '#000000',
                    title: '',
                    subtitle: '',
                    content: { 1: [''], 2: ['', ''], 4: ['', '', '', ''], 8: ['', '', '', '', '', '', '', ''] }
                }
            };

            // If template doesn't exist or is blank, create empty pages
            if (template === 'blank' || !templates[template]) {
                return;
            }

            const templateData = templates[template];
            const contentArray = templateData.content[pageCount] || templateData.content[1];

            // Generate pages
            for (let i = 0; i < pageCount; i++) {
                const pageContent = contentArray[i] || '';

                // Add decorative shape
                pages[i].elements.push({
                    id: `element-${elementIdCounter++}`,
                    type: 'shape',
                    svgContent: i === 0 ? createFloralCurves(templateData.color2, 0.2) : createModernArcs(templateData.color1, 0.2),
                    x: 0,
                    y: 0,
                    width: selectedPaperSize === 'a4' ? 794 : 559,
                    height: selectedPaperSize === 'a4' ? 1123 : 794,
                    zIndex: 1
                });

                // Add title on first page
                if (i === 0 && templateData.title) {
                    pages[i].elements.push({
                        id: `element-${elementIdCounter++}`,
                        type: 'text',
                        content: templateData.title,
                        x: 100,
                        y: 350,
                        width: selectedPaperSize === 'a4' ? 594 : 359,
                        height: 120,
                        fontSize: 64,
                        fontFamily: 'Playfair Display',
                        color: '#ffffff',
                        fontWeight: '900',
                        textAlign: 'center',
                        zIndex: 10
                    });

                    if (templateData.subtitle) {
                        pages[i].elements.push({
                            id: `element-${elementIdCounter++}`,
                            type: 'text',
                            content: templateData.subtitle,
                            x: 150,
                            y: 490,
                            width: selectedPaperSize === 'a4' ? 494 : 259,
                            height: 60,
                            fontSize: 28,
                            fontFamily: 'Montserrat',
                            color: templateData.color2,
                            fontWeight: '400',
                            textAlign: 'center',
                            fontStyle: 'italic',
                            zIndex: 10
                        });
                    }
                } else {
                    // Add content on other pages
                    pages[i].elements.push({
                        id: `element-${elementIdCounter++}`,
                        type: 'text',
                        content: pageContent,
                        x: 80,
                        y: pageCount === 1 ? 300 : 120,
                        width: selectedPaperSize === 'a4' ? 634 : 399,
                        height: 850,
                        fontSize: pageCount === 1 ? 32 : (pageCount <= 4 ? 28 : 22),
                        fontFamily: 'Roboto',
                        color: '#ffffff',
                        fontWeight: '400',
                        textAlign: pageCount === 1 ? 'center' : 'left',
                        lineHeight: '1.8',
                        zIndex: 10
                    });
                }
            }
        }

        // Element Management
        function addTextElement() {
            const element = {
                id: `element-${elementIdCounter++}`,
                type: 'text',
                content: currentLang === 'el' ? 'ÎšÎµÎ¯Î¼ÎµÎ½Î¿' : 'Text',
                x: 100,
                y: 100,
                width: 300,
                height: 60,
                fontSize: 32,
                fontFamily: 'Roboto',
                color: '#000000',
                backgroundColor: 'transparent',
                fontWeight: '400',
                textAlign: 'left',
                zIndex: elementIdCounter
            };

            pages[currentPage].elements.push(element);
            renderCurrentPage();
        }

        function openImageUpload(type) {
            currentImageType = type;
            document.getElementById('imageUploadModal').classList.add('active');
        }

        function closeImageUpload() {
            document.getElementById('imageUploadModal').classList.remove('active');
            currentImageType = null;
        }

        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    let element;

                    if (currentImageType === 'background') {
                        // Background image fills the entire page
                        const canvas = document.querySelector(`#pageCanvas${currentPage}`);
                        const width = canvas.offsetWidth;
                        const height = canvas.offsetHeight;

                        element = {
                            id: `element-${elementIdCounter++}`,
                            type: 'background',
                            src: e.target.result,
                            x: 0,
                            y: 0,
                            width: width,
                            height: height,
                            zIndex: 0
                        };
                    } else {
                        // Regular image or logo
                        const maxWidth = currentImageType === 'logo' ? 200 : 400;
                        const scale = Math.min(1, maxWidth / img.width);
                        const width = img.width * scale;
                        const height = img.height * scale;

                        element = {
                            id: `element-${elementIdCounter++}`,
                            type: currentImageType,
                            src: e.target.result,
                            x: 100,
                            y: 100,
                            width: width,
                            height: height,
                            zIndex: elementIdCounter
                        };
                    }

                    pages[currentPage].elements.push(element);
                    renderCurrentPage();
                    closeImageUpload();
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);

            // Reset input
            event.target.value = '';
        }

        function createElementDOM(element) {
            const el = document.createElement('div');
            el.className = 'canvas-element';
            el.dataset.id = element.id;
            el.style.left = element.x + 'px';
            el.style.top = element.y + 'px';
            el.style.width = element.width + 'px';
            el.style.height = element.height + 'px';
            el.style.zIndex = element.zIndex || 1;

            if (element.type === 'text') {
                el.classList.add('text-element');
                el.textContent = element.content;
                el.style.fontSize = element.fontSize + 'px';
                el.style.fontFamily = element.fontFamily;
                el.style.color = element.color;
                el.style.backgroundColor = element.backgroundColor || 'transparent';
                el.style.fontWeight = element.fontWeight || '400';
                el.style.textAlign = element.textAlign || 'left';
                el.style.lineHeight = element.lineHeight || '1.4';
                el.style.letterSpacing = element.letterSpacing || '0px';
                if (element.fontStyle) el.style.fontStyle = element.fontStyle;
            } else if (element.type === 'shape') {
                // SVG shape element
                el.classList.add('shape-element');
                el.innerHTML = element.svgContent;
                if (element.opacity) {
                    el.style.opacity = element.opacity;
                }
            } else {
                // Image, logo, or background
                el.classList.add('image-element');
                const img = document.createElement('img');
                img.src = element.src;
                el.appendChild(img);

                if (element.type === 'background') {
                    el.style.zIndex = 0;
                    img.style.objectFit = 'cover';
                    img.style.width = '100%';
                    img.style.height = '100%';
                }
            }

            // Add resize handle
            const resizeHandle = document.createElement('div');
            resizeHandle.className = 'resize-handle';
            el.appendChild(resizeHandle);

            // Add delete handle
            const deleteHandle = document.createElement('div');
            deleteHandle.className = 'delete-handle';
            deleteHandle.textContent = 'Ã—';
            deleteHandle.onclick = (e) => {
                e.stopPropagation();
                deleteElement(element.id);
            };
            el.appendChild(deleteHandle);

            // Make draggable
            makeDraggable(el, element);

            // Make selectable
            el.onclick = (e) => {
                e.stopPropagation();
                selectElement(element.id);
            };

            return el;
        }

        function makeDraggable(el, element) {
            let isDragging = false;
            let isResizing = false;
            let startX, startY, startWidth, startHeight;

            el.onmousedown = function(e) {
                if (e.target.classList.contains('resize-handle')) {
                    isResizing = true;
                    startX = e.clientX;
                    startY = e.clientY;
                    startWidth = el.offsetWidth;
                    startHeight = el.offsetHeight;
                } else if (!e.target.classList.contains('delete-handle')) {
                    isDragging = true;
                    startX = e.clientX - el.offsetLeft;
                    startY = e.clientY - el.offsetTop;
                }

                e.preventDefault();
            };

            document.onmousemove = function(e) {
                if (isDragging) {
                    const canvas = document.querySelector(`#pageCanvas${currentPage}`);
                    const canvasRect = canvas.getBoundingClientRect();
                    let newX = e.clientX - canvasRect.left - startX;
                    let newY = e.clientY - canvasRect.top - startY;

                    // Constrain to canvas
                    newX = Math.max(0, Math.min(newX, canvas.offsetWidth - el.offsetWidth));
                    newY = Math.max(0, Math.min(newY, canvas.offsetHeight - el.offsetHeight));

                    el.style.left = newX + 'px';
                    el.style.top = newY + 'px';

                    element.x = newX;
                    element.y = newY;
                } else if (isResizing) {
                    const newWidth = startWidth + (e.clientX - startX);
                    const newHeight = startHeight + (e.clientY - startY);

                    if (newWidth > 20 && newHeight > 20) {
                        el.style.width = newWidth + 'px';
                        el.style.height = newHeight + 'px';

                        element.width = newWidth;
                        element.height = newHeight;

                        // Update font size proportionally for text elements
                        if (element.type === 'text') {
                            const scale = newWidth / startWidth;
                            element.fontSize = Math.max(12, element.fontSize * scale);
                            el.style.fontSize = element.fontSize + 'px';
                        }
                    }
                }
            };

            document.onmouseup = function() {
                isDragging = false;
                isResizing = false;
            };
        }

        function selectElement(elementId) {
            selectedElement = elementId;

            // Update visual selection
            document.querySelectorAll('.canvas-element').forEach(el => {
                el.classList.toggle('selected', el.dataset.id === elementId);
            });

            // Update layers
            updateLayers();

            // Update properties panel
            updatePropertiesPanel();
        }

        function deleteElement(elementId) {
            const index = pages[currentPage].elements.findIndex(el => el.id === elementId);
            if (index !== -1) {
                pages[currentPage].elements.splice(index, 1);
                selectedElement = null;
                renderCurrentPage();
            }
        }

        function updateLayers() {
            const layersList = document.getElementById('layersList');
            layersList.innerHTML = '';

            const elements = pages[currentPage].elements;

            // Sort by z-index (highest first)
            const sortedElements = [...elements].sort((a, b) => (b.zIndex || 0) - (a.zIndex || 0));

            sortedElements.forEach(element => {
                const layer = document.createElement('div');
                layer.className = `layer-item ${selectedElement === element.id ? 'active' : ''}`;
                layer.onclick = () => selectElement(element.id);

                const name = document.createElement('span');
                name.className = 'layer-name';
                name.textContent = element.type === 'text' ?
                    (element.content.substring(0, 20) + (element.content.length > 20 ? '...' : '')) :
                    element.type.charAt(0).toUpperCase() + element.type.slice(1);

                const controls = document.createElement('div');
                controls.className = 'layer-controls';

                const upBtn = document.createElement('button');
                upBtn.className = 'layer-btn';
                upBtn.textContent = 'â†‘';
                upBtn.onclick = (e) => {
                    e.stopPropagation();
                    moveLayer(element.id, 'up');
                };

                const downBtn = document.createElement('button');
                downBtn.className = 'layer-btn';
                downBtn.textContent = 'â†“';
                downBtn.onclick = (e) => {
                    e.stopPropagation();
                    moveLayer(element.id, 'down');
                };

                controls.appendChild(upBtn);
                controls.appendChild(downBtn);

                layer.appendChild(name);
                layer.appendChild(controls);
                layersList.appendChild(layer);
            });
        }

        function moveLayer(elementId, direction) {
            const element = pages[currentPage].elements.find(el => el.id === elementId);
            if (!element) return;

            const delta = direction === 'up' ? 1 : -1;
            element.zIndex = (element.zIndex || 0) + delta;

            renderCurrentPage();
        }

        function updatePropertiesPanel() {
            const panel = document.getElementById('propertiesPanel');

            if (!selectedElement) {
                panel.innerHTML = `<p style="font-size: 12px; color: rgba(255,255,255,0.5); text-align: center; margin-top: 20px;" data-i18n="selectElement">
                    ${translations[currentLang].selectElement}
                </p>`;
                return;
            }

            const element = pages[currentPage].elements.find(el => el.id === selectedElement);
            if (!element) return;

            let html = '';

            if (element.type === 'text') {
                html = `
                    <div class="form-group">
                        <label class="form-label" data-i18n="text">${translations[currentLang].text}</label>
                        <textarea class="form-input" style="min-height: 100px;" onchange="updateElementProperty('content', this.value)">${element.content}</textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="fontSize">${translations[currentLang].fontSize}</label>
                        <input type="number" class="form-input" value="${element.fontSize}" onchange="updateElementProperty('fontSize', this.value)">
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="fontFamily">${translations[currentLang].fontFamily}</label>
                        <select class="form-select" onchange="updateElementProperty('fontFamily', this.value)">
                            <option value="Roboto" ${element.fontFamily === 'Roboto' ? 'selected' : ''}>Roboto</option>
                            <option value="Montserrat" ${element.fontFamily === 'Montserrat' ? 'selected' : ''}>Montserrat</option>
                            <option value="Playfair Display" ${element.fontFamily === 'Playfair Display' ? 'selected' : ''}>Playfair Display</option>
                            <option value="Lora" ${element.fontFamily === 'Lora' ? 'selected' : ''}>Lora</option>
                            <option value="Raleway" ${element.fontFamily === 'Raleway' ? 'selected' : ''}>Raleway</option>
                            <option value="Open Sans" ${element.fontFamily === 'Open Sans' ? 'selected' : ''}>Open Sans</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="textColor">${translations[currentLang].textColor}</label>
                        <div class="color-picker-group">
                            <input type="color" class="color-input" value="${element.color}" onchange="updateElementProperty('color', this.value)">
                            <input type="text" class="form-input" style="flex: 1;" value="${element.color}" onchange="updateElementProperty('color', this.value)">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="backgroundColor">${translations[currentLang].backgroundColor}</label>
                        <div class="color-picker-group">
                            <input type="color" class="color-input" value="${element.backgroundColor || '#ffffff'}" onchange="updateElementProperty('backgroundColor', this.value)">
                            <input type="text" class="form-input" style="flex: 1;" value="${element.backgroundColor || 'transparent'}" onchange="updateElementProperty('backgroundColor', this.value)">
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Font Weight</label>
                        <select class="form-select" onchange="updateElementProperty('fontWeight', this.value)">
                            <option value="300" ${element.fontWeight === '300' ? 'selected' : ''}>Light</option>
                            <option value="400" ${element.fontWeight === '400' ? 'selected' : ''}>Regular</option>
                            <option value="600" ${element.fontWeight === '600' ? 'selected' : ''}>Semi-Bold</option>
                            <option value="700" ${element.fontWeight === '700' ? 'selected' : ''}>Bold</option>
                            <option value="900" ${element.fontWeight === '900' ? 'selected' : ''}>Black</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Text Align</label>
                        <select class="form-select" onchange="updateElementProperty('textAlign', this.value)">
                            <option value="left" ${element.textAlign === 'left' ? 'selected' : ''}>Left</option>
                            <option value="center" ${element.textAlign === 'center' ? 'selected' : ''}>Center</option>
                            <option value="right" ${element.textAlign === 'right' ? 'selected' : ''}>Right</option>
                            <option value="justify" ${element.textAlign === 'justify' ? 'selected' : ''}>Justify</option>
                        </select>
                    </div>
                `;
            }

            html += `
                <div class="form-group">
                    <label class="form-label" data-i18n="width">${translations[currentLang].width}</label>
                    <input type="number" class="form-input" value="${Math.round(element.width)}" onchange="updateElementProperty('width', this.value)">
                </div>
                <div class="form-group">
                    <label class="form-label" data-i18n="height">${translations[currentLang].height}</label>
                    <input type="number" class="form-input" value="${Math.round(element.height)}" onchange="updateElementProperty('height', this.value)">
                </div>
            `;

            panel.innerHTML = html;
        }

        function updateElementProperty(property, value) {
            if (!selectedElement) return;

            const element = pages[currentPage].elements.find(el => el.id === selectedElement);
            if (!element) return;

            // Convert numeric values
            if (property === 'fontSize' || property === 'width' || property === 'height') {
                value = parseFloat(value);
            }

            element[property] = value;
            renderCurrentPage();
            selectElement(selectedElement); // Re-select to update properties panel
        }

        // Zoom Controls
        function zoomIn() {
            zoom = Math.min(zoom + 0.1, 2);
            applyZoom();
        }

        function zoomOut() {
            zoom = Math.max(zoom - 0.1, 0.3);
            applyZoom();
        }

        function zoomReset() {
            zoom = 1;
            applyZoom();
        }

        function applyZoom() {
            const canvas = document.querySelector('.preview-container');
            if (canvas) {
                canvas.style.transform = `scale(${zoom})`;
                canvas.style.transformOrigin = 'top center';
            }
        }

        // Export Functions
        async function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: selectedPaperSize === 'a4' ? 'portrait' : 'portrait',
                unit: 'mm',
                format: selectedPaperSize
            });

            for (let i = 0; i < pages.length; i++) {
                // Temporarily switch to this page
                const originalPage = currentPage;
                currentPage = i;
                renderCurrentPage();

                // Wait for render
                await new Promise(resolve => setTimeout(resolve, 100));

                const canvas = document.querySelector(`#pageCanvas${i}`);
                if (!canvas) continue;

                const imgData = await html2canvas(canvas, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff'
                });

                const imgWidth = selectedPaperSize === 'a4' ? 210 : 148;
                const imgHeight = selectedPaperSize === 'a4' ? 297 : 210;

                if (i > 0) {
                    doc.addPage();
                }

                doc.addImage(imgData.toDataURL('image/png'), 'PNG', 0, 0, imgWidth, imgHeight);

                // Restore original page
                currentPage = originalPage;
            }

            doc.save('brochure.pdf');
            renderCurrentPage();
        }

        async function exportToImages() {
            for (let i = 0; i < pages.length; i++) {
                // Temporarily switch to this page
                const originalPage = currentPage;
                currentPage = i;
                renderCurrentPage();

                // Wait for render
                await new Promise(resolve => setTimeout(resolve, 100));

                const canvas = document.querySelector(`#pageCanvas${i}`);
                if (!canvas) continue;

                const imgData = await html2canvas(canvas, {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: '#ffffff'
                });

                // Download image
                const link = document.createElement('a');
                link.download = `brochure-page-${i + 1}.png`;
                link.href = imgData.toDataURL('image/png');
                link.click();

                // Restore original page
                currentPage = originalPage;
            }

            renderCurrentPage();
        }

        // Drag and Drop Setup
        function setupDragAndDrop() {
            document.addEventListener('click', (e) => {
                if (e.target.closest('.canvas-element')) return;
                if (e.target.closest('.right-sidebar')) return;

                // Deselect
                selectedElement = null;
                document.querySelectorAll('.canvas-element').forEach(el => {
                    el.classList.remove('selected');
                });
                updateLayers();
                updatePropertiesPanel();
            });
        }

        // Initialize app
        window.onload = function() {
            init();
        };
    </script>
</body>
</html>
